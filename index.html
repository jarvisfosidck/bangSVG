<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<title>bang SVG</title>
<style type="text/css">
#pathGenText {
	width:100%;
	padding:2px;
	font-size:6px;
}
</style>
</head>

<body>

<div id="svgDisplayArea">


<?xml version="1.0" encoding="utf-8"?>
<svg version="1.1" id="bangSVG" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 792 612" enable-background="new 0 0 792 612" xml:space="preserve">



<g>
	<rect x="64.3" y="93" fill="#FFFFFF" stroke="#000000" stroke-miterlimit="10" width="289.6" height="265.9"/>
	<g>
		<g>
			<g>
				<polygon fill="#FFFFFF" points="516,259.4 252.3,259.4 252.3,546.9 589.5,546.9 589.5,354.5 516,354.5 				"/>
			</g>
			<g>
				<polygon fill="none" stroke="#000000" stroke-miterlimit="10" points="516,259.4 252.3,259.4 252.3,546.9 589.5,546.9
					589.5,354.5 516,354.5 				"/>
			</g>
		</g>
		<g>
			<g>
				<polygon fill="#FFFFFF" points="725.7,166.4 516,166.4 516,259.4 516,354.5 589.5,354.5 725.7,354.5 				"/>
			</g>
			<g>
				<polygon fill="none" stroke="#000000" stroke-miterlimit="10" points="725.7,166.4 516,166.4 516,259.4 516,354.5 589.5,354.5
					725.7,354.5 				"/>
			</g>
		</g>
	</g>
</g>
<g id="logo_fill">
	<polyline fill="#53C2BF" points="135.8,0 135.8,267.9 203.7,213.4 135.8,0 	"/>
	<g>
		<polygon fill="#53C2BF" points="135.8,0 203.7,213.4 271.7,213.4 		"/>
	</g>
	<polyline fill="#53C2BF" points="135.8,0 135.8,267.9 67.9,213.4 135.8,0 	"/>
	<g>
		<polygon fill="#53C2BF" points="135.8,0 67.9,213.4 0,213.4 		"/>
	</g>
</g>
<g id="logo_outline">
	<polyline fill="#53C2BF" points="135.8,0 135.8,267.9 203.7,213.4 135.8,0 	"/>
	<g>
		<polygon fill="#53C2BF" points="135.8,0 203.7,213.4 271.7,213.4 		"/>
	</g>
	<polyline fill="#53C2BF" points="135.8,0 135.8,267.9 67.9,213.4 135.8,0 	"/>
	<g>
		<polygon fill="#53C2BF" points="135.8,0 67.9,213.4 0,213.4 		"/>
	</g>
</g>

<path id="complexLine" fill="none" stroke="#000000" stroke-miterlimit="10" d="M414.7,58.3l212.2-27.5L646,80.5l-9.2,50.4c0,0-69.5,5.3-69.5,1.5
	c0-3.8,1.5-47.3,1.5-47.3l42.7-1.5l-5.3-19.8L491.8,75.9l-76.3,39.7L414.7,58.3z"/>


</svg>

</div>

<input type="text" id="pathGenText" class="pathGenText">


<script type="text/javascript">

function _(id) {
  return document.getElementById(id);
}
function _circ(svg,attrs) {
	var c = document.createElementNS(xmlns,"circle")
	for (var a in attrs) {
		c.setAttributeNS(null, a,attrs[a]);
	}
	return c;
}



function _ppline() {
	prettyPoints.push(prettyPoints[0]);
	/*prettyPoints = prettyPoints.map(function(a) {
		return a.split(",").map(function(b) {
			//console.log(b);
			b = parseFloat(b);//.toFixed(4);
			//console.log(b);
			return b;
		}).join(",");
	});*/

	var p = document.createElementNS(xmlns,"polyline")
	,attrs = {
		'stroke' : '#31da24'
		,'points' : prettyPoints //closes the shape
		,'fill' : "#ededed"
		,'fill-opacity' : 0.5
		,'stroke-width' : 2
	}
	for (var a in attrs) {
		p.setAttributeNS(null, a,attrs[a]);
	}
	svg.appendChild(p);

	var el = _('pathGenText');
	var s = prettyPoints.join("L");
	s = '<path d="M' + s + '" />';
	el.value = s;
	return p;
}
	_('pathGenText').value = "";

//	R=SVGDoc.createElementNS(xmlns,"rect")
//SVGRoot.appendChild(R)
//SVGDoc.getElementById(id)


var svg = _('bangSVG')
,pointsArray = []
,prettyPoints = []
,xmlns="http://www.w3.org/2000/svg"
,c = svg.getElementsByTagNameNS(xmlns,'polygon')
,pl = svg.getElementsByTagNameNS(xmlns,'polyline')
,rects = svg.getElementsByTagNameNS(xmlns,'rect')
,dots
,prettyLine = function() {

		line = document.createElementNS(xmlns,"circle")
		,update = function() {

			//do stuff here

		}


	}
;
function getRectPoints(c) {
	for(var i = 0,len=c.length; i < len; i++) {
		var b = c[i].getBBox();
		var dots = {
		 	 a : b.x + "," + b.y
			,b : (b.x+b.width) + "," + b.y
			,c : (b.x+b.width) + "," + (b.y+b.height)
			,d : b.x+ "," + (b.y+b.height)
		}

		for (var d in dots) {
			if (pointsArray.indexOf(dots[d]) === -1 ) {
				pointsArray.push(dots[d]);
			}
		}
	}
}
function getPoints(c) {
	for(var i = 0,len=c.length; i < len; i++) {
		dots = c[i].getAttribute('points').split(" ");
		for (var d in dots) {
			var pp = dots[d].replace(/[^.,0-9]/g,"");
			if (pointsArray.indexOf(pp) === -1 && pp != "") {
				pointsArray.push(pp);
			}
		}
	}

}
getPoints(c);getPoints(pl);getRectPoints(rects)
var params = {
	'fill' : 'red'
	,'stroke' : '#da2424'
	,'cx' : 40
	,'cy' : 40
	,'r' : 8

}

for (var p in pointsArray) {
	var xy = pointsArray[p].split(",");
	params.cx = xy[0];
	params.cy = xy[1];
	var o = _circ(svg,params);
	o.addEventListener("click",setPrettyPoints);
	svg.appendChild(o);
}

function setPrettyPoints(evt) {
	var c = evt.target,
	pair = c.getAttribute('cx') + "," + c.getAttribute('cy');
	prettyPoints.push(pair);
	var params = {
	'fill' : 'yellow'
	,'stroke' : '#da2424'
	,'cx' : c.getAttribute('cx')
	,'cy' : c.getAttribute('cy')
	,'r' : 3

	}
	var o = _circ(svg,params);
	svg.appendChild(o);
}


function updatePrettyLine() {




}

eventHandler = function() {
	"use strict";

	this.clickStack = new Array()

	this.listen = function(evt) {
		this.clickStack.push(evt);
		this.think();

	}
	this.think = function() {
		var cS = this.clickStack,rS = cS.reverse();
		console.log(rS[0] === 'DBCLICK' && rS[1] === 'CLICK'0],rS[1],rS[2])
		if (rS[1] === 'DBLCLICK' && rS[0] === 'CLICK' && rS[2] === 'CLICK') {

				clearLastBang();
				console.log('cats')

		}


	}
	this.report = function(o) {
		for (var x in this.clickStack) {
			if (o) {
				console.log(this.clickStack[x].o);
			} else {
				console.log(this.clickStack[x]);
			}
		}
	}

	this.init = function(params) {
		var el = document.getElementsByTagName('body')[0];
		var that = this;
		["CLICK", "DBLCLICK", "KEYDOWN", "KEYUP", "KEYPRESS"].forEach(function(ev) {
			el.addEventListener(ev.toLowerCase(), function() {
					that.listen(ev);
			})
		});
		return true;
	}

}

eh = new eventHandler();
eh.init();

function clearLastBang() {
	console.log(lastLine);
	lastLine.parentNode.removeChild(lastLine)
}
var lastLine;
_('svgDisplayArea').addEventListener("dblclick", function() {
	lastLine = _ppline();
});







//grab all the svg line, polyline, polygon elements

//find all the end points

//make them into cool shapes and colors





















</script>

</body>
</html>
